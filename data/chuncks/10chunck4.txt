assembled SOMEIP header is passed to the upper layer RSSOMEIP00010 RSSOMEIP00051 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 28 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol SWSSomeIpTp00 036 The SOMEIP TP module shall store the number of Payload bytes for every PDU ID separately which has been passed to the upper layer RSSOMEIP00010 Note This information will be used to verify the Offset Value of the consecutive SOMEIP segments Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 29 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 732 SOMEIP segment received with Offset 0 SWSSomeIpTp00 037 If a SOMEIP segment is successfully received with Offset Field 0 the SOMEIP TP module shall compare the received SOMEIP header fields with the values of the stored SOMEIP header fields which has been received with the first segment ie Offset was set to 0 Request ID 32 bit Protocol Version 8 bit Interfa ce Version 8 bit Message Type 8 bit Return C ode 8 bit If these values match restart the SomeIpTpRxTimeoutTime and continue with the assembly process RSSOMEIP00010 SWSSomeIpTp00 038 The SOMEIP TP module shall store the number of Payload bytes for every PDU ID separately which has been passed to the upper layer RSSOMEIP00010 SWSSomeIpTp00 039 The SOMEIP TP module shall compare the value of the Offset Field with the sum divided by 16 of copied Payload bytes since the first received SOM EIP segment ie with Offset F ield set to 0 If this sum divided by 16 matches with the current Offset V alue and i f the bufferSizePtr provided by the previous call of the API PduRSomeIpTpCopyRxDat ais greater or equal to the received payload call the API PduRSomeIpTpCopyRxData with SduLength set to the received Payload bytes RSSOMEIP00010 Note In case of Offset Field value 0 only the Payload bytes are provided to the upper layer without any SOMEIP header fields SWSSomeIpTp00 040 If a SOMEIP segment is successfully received with the More Segment Flag set to 0 the SOMEIP TP module shall Cancel the Rx timeout tim e defined by SomeIpTpRxTimeoutTime Call the API PduRSomeIpTpRxIndication after it has copied the remaining received Payload bytes to the upper layer as defined in SWSSomeIpTp00033 RSSOMEIP00010 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 30 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 733 Interruption of the assembly process SWSSomeIpTp00 041 If the Rx timeout time defined by SomeIpTpR xTimeoutTime expires The current assembly process shall be interrupted as defined by SWSSomeIpTp00054 The API DetReportRuntimeError shall be called with the runtime e rror code SOMEIPTPEASSEMBLYINTERRUPT RSSOMEIP00010 RSSOMEIP00738 SWSSomeIpTp00 042 If the API SomeIpTpRxIndication is called with the Offset Value is 0 but no session is currently running The received PDU shall be ignored The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEINCONSISTENTSEQUENCE RSSOMEIP00010 RSSOMEIP00051 Note This check identifies that at least the first segment has not been received SWSSomeIpTp00 054 If the SOMEIP TP module interrupts the assembly process because of a detected error the SOMEIP TP module shall Call the API PduRSomeIpTpRxIndication for this PDU ID with ENOTOK The Rx timeout time defined by SomeIpTpRxTimeoutTime shall be cance led if sti ll running for this PDU ID RSSOMEIP00010 Note The possible reasons for interruptions are listed below SWSSomeIpTp00 062 If the SOMEIP TP module detect s an inconsistency of the received SOMEIP TP headers ie Request ID Protocol Version Interface Version Message Typ e or Return Code are not equal for all received segments The current assemb ly process shall be interrupted as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the r untime error code SOMEIPTPEINCONSISTENTHEADER RSSOMEIP00010 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 31 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol SWSSomeIpTp00 045 If the API SomeIpTpRxIndication is called and a session is currently active the SOMEIP TP module shall check if the TP Flag of the Message Type is set to 1 If the TP Flag is not set to 1 The current assembly process shall be interrupt ed as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the r untime error code SOMEIPTPEMESSAGETYPE RSSOMEIP00010 SWSSomeIpTp00 063 If the API SomeIpTpRxIndication is called the SOMEIP TP module shall check whether the received payload bytes are dividable by 16 in case the More Segment Flag is set to 1 If the received payload bytes are not dividable by 16 in this case The current assembly process shall be interrupted as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the r untime error code SOMEIPTPEASSEMBLYINTERRUPT RSSOMEIP00010 RSSOMEIP00051 SWSSomeIpTp00 064 If the API SomeIpTpRxIndication is called the SOMEIP TP module shall check the value of the Offset Field If the Offset V alue in units of 16 bytes does not match to the sum of the received Payload bytes of the previous SOMEIP segments The current assembl y process shall be interrupted as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPE INCONSISTENTSEQUENCE RSSOMEIP00010 RSSOMEIP00051 SWSSomeIpTp00 048 If the API SomeIpTpRxIndication is called the SOMEIP TP module shall check the value of the Offset Field If the received Offset Value equals 0 while the received Payload bytes of the previous SOMEIP segments is greater than 0 the SOMEIP TP module shall perform the following steps in the following order The current assembly process shall be interrupted as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEINCONSISTENTSEQUENCE Start the assembly process according to chapter 731 SOMEIP segment received with Offset 0 RSSOMEIP00010 RSSOMEIP00051 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 32 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol SWSSomeIpTp00 049 If the bufferSizePtr provided by the API PduRSomeIpTpStartOfReception or PduRSomeIpTpCopyRxData is smaller than the sum of the received and the added SOMEIP header in case of the first segment or the received payload in case of any subsequent segme nt The current assembl y process shall be interrupted as defined by SWSSomeIpTp000 54 The API DetReportRuntimeError shall be called with the runtime e rror code SOMEIPTPEASSEMBLYINTERRUPT RSSOMEIP00010 SWSSomeIpTp00 050 If the API PduRSomeIpTpCopyR xDatareturns something else than BUFREQOK The assembly process for this PDU ID shall be