for classication were designed around the assumption of an equal number of examples for each class An alternative solution would be the adoption of specialized techniques such asAdaptive Weighting 25 This technique implemented in our work is considered as a popular approach for imbalance learning since it weighs samples in rare classes with high cost and then applies costsensitive learning methods to deal with imbalance in classes Table III presents the weights assigned for each class for the dataset considered in this work TABLE III CLASS WEIGHT Class Class Weight Normal 016 Error on Event 668 Error on Error 1035 Missing Response 433 Missing Request 486 3 SOMEIP intrusions The SOMEIP attacker is able to compromise a known device within the system Thus it has a valid MAC address IP address and service ID It eavesdrops on all trafc within the network and send packets to all clients and all servers and thus impersonates other SOMEIP devices and services 3 Through our work we are interested in cyberattacks which lead to deviations from the protocol specications in a communication session between two devices as seen in Figure 3 and which can be detected using deep learning based sequential Models These four intrusion types considered in this work are detailed below illustrated also in Figure 3 Requests without Response Requests have to be an swered with either a response or an error message If a request was never answered it means that an attacker has relayed the communication between the client and the server who believe that they are directly communicatingTABLE IV DATASET FEATURES Feature Description Service ID A unique identier for a service Method IDA unique identier of a method an event or a eld that belong to the service Client IDAllows a server to differentiate calls from multiple clients to the same method Message TypeUsed to differentiate different types of messages such as requestrequest no return notication response and error Session IdAllows a subscriber to differentiate multiple calls to the same method Interface Version Contains the Major Version of the Service Interface Protocol Version Contains the SOMEIP protocol version Return CodeUsed to signal whether a request was successfully processed IP source IP of the sending device IP destination IP of the receiving device Protocol Application layer protocol Source Port Port number of the sending device Destination Port Port number of the receiving device Mac source MAC Address of the sending device Mac destination MAC Address of the receiving device LabelSpecies the class of each packet such as normal error on error error on event request without response response without request with each other Response without Request A response should only be delivered in response to an open previous request As a result a normal request with message type 0x00 should be answered by a single response with message type 0x80 Two replies to a single request break the protocol and may indicate the existence of an attacker attempting to impersonate the server and injecting extra packets Error on Error Based on AUTOSAR standard speci cation an error message should not be answered with another error message Hence an incoming error which doesnt have a corresponding request or other packet with the same settings indicates the presence of a network intrusion Error on Event Notications should not be answered with an error message Thus a notication replied to withan error depicts a network intrusion between the client and the server 4 Data Preparation This section describes the different steps seen in Figure 4 achieved for our dataset to be fed to our deep learning based IDS for training and testing 1Packets generation and labeling The SOMEIP packet generator is able to generate pcap les composed of unlabeled packets gathered from the whole network Since we are using a supervised learning approach we had to label each packet Hence a packet is labeled by 0 if it behaves according to the AUTOSAR standard specication Otherwise it is labeled by 123 or 4 if it represents error on event error on error request without response or response without request attacks respectively 2Packets Feature Extraction and OneHot Encoding Each packet is represented by 16 categorical features described in Table IV However these features had to be converted to binary vectors using onehot encoding technique In fact many deep learning algorithms cannot work with categorical data directly Hence the cate gories must be converted into numbers This is required for both input and output variables that are categorical After encoding the 15 features that represented input variables were extended to 195 features and the output variable Label was extended to 5 classes 3Grouping Packets into Sequences In order to detect intrusions affecting the communication behavior be tween two devices we had to group packets that belong to each communication in their appropriate sequence Hence each sequence represents a series of ordered packets exchanged between a client and a server with the same session identier As seen in Figure 4 we have grouped packets in their corresponding sequences Thus our IDS will detect the presence of an intrusion in a communication between a client and a server by inspecting each sequence of packets However since we are dealing with variable length sequence prediction problems our data had be transformed such that each sequence has the same length Hence after transfor mation each sequence contains 60 packets which is the maximum number of packets per sequence ie a sequence is padded by zeros if it contains less than 60 packets per session Our dataset was generated with the constraints that only one type of attack can occur between two devices Therefore sequences are either labeled as normal or by a number corresponding to only one of the four possible intrusions Furthermore an attack begins and ends in the same session between a client and a server Hence an attack cannot be executed in different sessions at the same time 4Sequences Concatenation Finally after labeling the different sequences that represent diverse attacks we have concatenated them in a single dataset that will used for training and testing the deep learning based IDSV P ROPOSED SEQUENTIAL MODEL Fig 5 RNN based IDS