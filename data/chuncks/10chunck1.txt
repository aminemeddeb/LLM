Protocol AUTOSAR CP R2011 10 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 6 Requirements traceability Requirement Description Satisfied by RSSOMEIP00010 SOMEIP protocol shall support different transport protocols underneath SWSSomeIpTp00001 SWSSomeIpTp00002 SWSSomeIpTp00004 SWSSomeIpTp00005 SWSSomeIpTp00006 SWSSomeIpTp00008 SWSSomeIpTp00010 SWSSomeIpTp00011 SWSSomeIpTp00012 SWSSomeIpTp00013 SWSSomeIpTp00014 SWSSomeIpTp00015 SWSSomeIpTp000 16 SWSSomeIpTp00017 SWSSomeIpTp00018 SWSSomeIpTp00019 SWSSomeIpTp00020 SWSSomeIpTp00021 SWSSomeIpTp00022 SWSSomeIpTp00023 SWSSomeIpTp00024 SWSSomeIpTp00025 SWSSomeIpTp00026 SWSSomeIpTp00027 SWSSomeIpTp00028 SWSSomeIpTp 00029 SWSSomeIpTp00032 SWSSomeIpTp00033 SWSSomeIpTp00034 SWSSomeIpTp00035 SWSSomeIpTp00036 SWSSomeIpTp00037 SWSSomeIpTp00038 SWSSomeIpTp00039 SWSSomeIpTp00040 SWSSomeIpTp00041 SWSSomeIpTp00042 SWSSomeIpTp00045 SWSSome IpTp00048 SWSSomeIpTp00049 SWSSomeIpTp00050 SWSSomeIpTp00051 SWSSomeIpTp00054 SWSSomeIpTp00062 SWSSomeIpTp00063 SWSSomeIpTp00064 SWSSomeIpTp00077 RSSOMEIP00011 SOMEIP protocol shall support messages of different lengths SWSSom eIpTp00001 SWSSomeIpTp00002 SWSSomeIpTp00003 SWSSomeIpTp00004 SWSSomeIpTp00005 SWSSomeIpTp00006 RSSOMEIP00027 SOMEIP protocol shall define the header layout of messages SWSSomeIpTp00006 SWSSomeIpTp00009 SWSSomeIpTp00010 SWSSom eIpTp00011 SWSSomeIpTp00012 SWSSomeIpTp00013 SWSSomeIpTp00014 SWSSomeIpTp00015 SWSSomeIpTp00026 SWSSomeIpTp00077 RSSOMEIP00051 SOMEIP protocol shall provide support for segmented transmission of large data SWSSomeIpTp00002 SWSSom eIpTp00004 SWSSomeIpTp00005 SWSSomeIpTp00009 SWSSomeIpTp00012 SWSSomeIpTp00035 SWSSomeIpTp00042 SWSSomeIpTp00048 SWSSomeIpTp00063 SWSSomeIpTp00064 RSSOMEIP00738 SWSSomeIpTp00019 SWSSomeIpTp00023 SWSSomeIpTp00024 SWSSomeIpTp00025 SWSSomeIpTp00041 SWSSomeIpTp00050 SWSSomeIpTp00051 SRSBSW00301 All AUTOSAR Basic Software Modules shall only import the necessary information SWSSomeIpTp00043 SRSBSW00373 The main processing function of each AUTOSAR Basic Software Module shall be named according the defined convention SWSSomeIpTp00058 SWSSomeIpTp00069 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 11 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol SRSBSW00384 The Basic Software Module specifications shall specify at least in the descr iption which other modules they require SWSSomeIpTp00060 SWSSomeIpTp00061 SRSBSW00407 Each BSW module shall provide a function to read out the version information of a dedicated module implementation SWSSomeIpTp00044 SWSSomeIpTp00046 SRSBSW 00411 All AUTOSAR Basic Software Modules shall apply a naming rule for enablingdisabling the existence of the API SWSSomeIpTp00044 SWSSomeIpTp00046 SRSBSW00425 The BSW module description template shall provide means to model the defined trigger conditions of schedulable objects SWSSomeIpTp00058 SWSSomeIpTp00059 SWSSomeIpTp00069 SWSSomeIpTp00070 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 12 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 7 Functional specification The task of the SOMEIP TP module is to segment SOMEIP packets which do not fit into one single UDP packet On the reception side it assemble s the received SOMEIP segments The SOMEIP TP module interacts with the PDU Router for both directions the transmission and the reception path Figure 2 Location of the SOMEIP TP module Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 13 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 71 Overview of the SOMEIP header This chapter describe the relevant parts of the SOMEIP header for the segmentation of SOMEIP messages The Message T ype field of the SOMEIP header contains a bit which marks the SOMEIP PDU as a segment of an original SOMEIP message Every segmented SOMEIP message adds SOMEIP TP specific fields to the SOMEIP header These fields contain control information for the segment ation and the reassembly of original large SOMEIP messages How they are used is described in the following chapters Figure 3 SOMEIP TP header Note The Offset Field the Reserved bits and the More Segment Flag are only present if the TP Flag is set to 1 711 Message Type Field The Messag e Type Field contains the TP Flag which marks this SOMEIP message as a SOMEIP segment of an original SOMEIP message Figure 4 Location of the TP Flag Message Type 8 bit bit offset 16 17 18 19 20 21 22 23 Value x x 01 x x x x x Name ignore ignore TPFlag ignore ignore ignore ignore ignore Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 14 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 712 Offset Field The Offset Field 28 bits is located right after the Return Code field It starts at bit offset 0 and ends at bit offset 27 The contained value increases after every transmitted received segment according to the payload length of the previous transmitted received SOMEIP segment The Offset F ield contains the Offset V alue in units of 16 bytes Eg If the Offset Field is set to 92 1472 Payload bytes have been transmitted so f ar These two different terms are used in the remainder of this document Note The payload length provided in the Offset Field does not include the bytes which are needed for the SOMEIP header 713 Reserved Field The Reserved Field 3 bits follows the Offset Field It starts at bit offset 28 and ends at bit offset 30 These three bits are reserved and set to 0 714 More Segments Flag The More Segments Flag 1 bit indicates whether another segmented SOMEIP PDU will follow Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 15 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 715 Example An original SOMEIP message of 5571 bytes payload has to be transmitted The Length field of this original SOMEIP message is set to 8 5571 bytes Figure 5 Example Header of Original SOMEIP message This original SOMEIP message will now be segmented into 5 consecutive SOMEIP segments Every payload of these segments carries at most 1392 bytes in this example For these segments the SOMEIP TP module adds additional TP fields marked red The Length field of the SOMEIP carries the overal l length of the SOMEIP segment including 8 bytes for the Request ID Protocol Version Interface Version Message Type and Return Code Because of th e added TP fields 4 bytes this Length information is extended by 4 additional SOMEIP TP bytes The f ollowing figure provides an overview of the relevant SOMEIP header settings for every SOMEIP segment Length Bytes Message Type TP Flag Offset Value More Segment Flag 1st segment 8 4 1392 1404 TPFlag 1 0 1 2nd segment 8 4 1392 140 4 TPFlag 1 87 1 3rd segment 8 4 1392 140 4 TPFlag 1 174 1 4th segment 8 4 1392 140 4 TPFlag 1 261 1 5th segment 8 4 312 324 TPFlag 1 348 0 Figure 6 Example Overview of relevant SOMEIP TP headers Note Please be aware that the value provided within the Offset Field is given in units of 16 bytes ie The Offset Value of 87 correspond to 1 392 bytes Payload Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 16 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol The complete SOMEIP headers of the SOMEIP segments message will look like this in detail The first 4 segments contain 1392 Payload bytes each