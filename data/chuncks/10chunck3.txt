the SOMEIP TP module shall consider the available buffer size of the upper layer by evaluating the availableDataPtr provided by the API PduRSomeIpTpCopyTxData IeThe payload size of the next SOMEIP TP segment needs to be smaller or equal to the av ailable buffer AND dividable by 16 for all segments but for the last RSSOMEIP00010 RSSOMEIP00738 SWSSomeIpTp00 020 The SOMEIP TP module shall debounce s ubsequent calls of the API PduRSomeIpTpTransmit for the same PDU ID using the parameter SomeIpTpNPduSeparationTime It defines the time span between the call of SomeIpTpTxConfirmation and the subsequent call of the API PduRSomeIpTpTransmit RSSOMEIP00010 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 22 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol SWSSomeIpTp00 021 If the last SOMEIP segment of the original SOMEIP PDU has been transmitted successfully ie the call of SomeIpTp TxConfirmation with parameter success equals TRUE occurred for the last call of PduRSomeIpTpCopyTxData the SOMEIP TP module shall Call the API PduRSomeIpTp TxConfirmation RSSOMEIP00010 Note With the call of PduRSomeIpTp TxConfirmation the segmentation process is finished Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 23 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 724 Interru ption of the disassembly process SWSSomeIpTp00 022 If the API SomeIpTpTransmit is called with a PDU ID which is currently used for an ongoing segmentation ENOTOK shall be returned The ongoing dis assembly process for this PDU ID shall be canceled The API PduRSomeIpTpTxConfirmation with result set to ENOTOK shall be called The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEDISASSEMBLYINTERRUPT RSSOMEIP00010 SWSSomeIpTp00 023 If the API SomeIpTpTxConfirmation is called with parameter success set to FALSE The disassembly process for this PDU ID shall be canceled The API PduRSomeIpTp TxConfirmation with result set to ENOTOK shall be called The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEDISASSEMBLYINTERRUPT RSSOMEIP00010 RSSOMEIP00738 SWSSomeIpTp00 024 If the availableDataPtr provided by the API PduRSomeIpTpCopyTxData is smaller than 16 bytes or smaller than required for the last SOMEIP TP segment The disassembly process for this PDU ID shall be canceled The API PduRSomeIpTp TxConfirmation with result set to ENOTOK shall be called The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEDISASSEMBLYINTERRUPT RSSOMEIP00010 RSSOMEIP00738 SWSSomeIpTp00 025 If an API PduRSomeIpTpCopyTxData returns something else than BUFREQOK The disassembly process for this PDU ID shall be canceled The API PduRSomeIpTp TxConfirmation with result set to ENOTOK shall be called The API DetReportRuntimeError shall be called with the runtime error code SOMEIPTPEDISASSEMBLYINTERRUPT RSSOMEIP00010 RSSOMEIP00738 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 24 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 73 Assembly of received SOMEIP messages RX path SWSSomeIpTp00 031 If SomeIpTpRxIndication is called with TP Flag set to 0 SOMEIP TP shall call PduRSomeIpTpStartOfReception PduRSomeIpTpCopyRxData and PduRSomeIpTpRxIndication directly after each other providing the received indication SWSSomeIpTp00 071 If SomeIpTpRxIndication is called with TP Flag set to 1 Offset Field set to 0 and More Segment Flag set to 0 SOMEIP TP shall call PduRSomeIpTpStartOfReception PduRSomeIpTpCopyRxData and SomeIpTpRxIndication directly after each other providing the received indication SWSSomeIpTp00 026 If the API SomeIpTp RxIndication is called the SOMEIP TP module shall derive the following SOMEIP header information from the first 12 bytes of the received PDU Request ID 32 bit Protocol Version 8 bit Interface Version 8 bit Message Type 8 bit Return C ode 8 bit Offset 28 bit Reserved bits 3 bit More Segment Flag 1 bit RSSOMEIP00010 RSSOMEIP00010 RSSOMEIP00027 SWSSomeIpTp00 077 If the TP flag is not set and no assembly session is active only the following parameters shall be extracted Request ID 32 bit Protocol Version 8 bit Interface Version 8 bit Message Type 8 bit Return Code 8 bit RSSOMEIP00010 RSSOMEIP00027 SWSSomeIpTp00 027 Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 25 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol The SOMEIP TP module shall be able to store the value of the Offset Field for every PDU ID separately RSSOMEIP00010 SWSSomeIpTp00 028 The SOMEIP TP module shall be able to store the number of Payload bytes for every PDU ID separately which has been passed by a call of SomeIpTp RxIndication RSSOMEIP00010 SWSSomeIpTp00 029 The SOMEIP TP module shall store the status of the More Segment Flag for every PDU ID separately which is passed by a call of SomeIpTPRxIndication RSSOMEIP00010 SWSSomeIpTp00 030 The SOMEIP TP module shall buffer the pointer to the Meta data for every PDU ID separately which is passed by the PduInfoPtr parameter of the API SomeIpTpRxIndication and forward this information when PduRSomeIpTpStartOf Reception is called Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 26 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol Specification on SOMEIP Transport Protocol AUTOSAR CP R2011 27 of 59 Document ID 809AUTOSARSWSSOMEIPTransportProtocol 731 SOMEIP segment received with Offset 0 SWSSomeIpTp00 032 If a SOMEIP segment is successfully received with Offset Field set to 0 the SOMEIP TP module shall store the values of the received SOMEIP header for each PDU ID separatelyThese values shall be used as reference values for the expected following consecutive receiv ing SOMEIP segments ie with Offset Field set to 0 RSSOMEIP00010 SWSSomeIpTp00 033 If a SOMEIP segment is successfully received with Offset Field set to 0 the SOMEIP TP module shall Start the Rx timeout time defined by SomeIpTpRxTimeoutTime Call the API PduRSomeIpTpStartOfReception with the PDU ID derived from the parameter SomeIpTpRxSduRef and the TpSduLength set to 0 RSSOMEIP00010 Note TpSduLength set to 0 indicates unknown message length to the upper layers SWSSomeIpTp00 034 If a SOMEIP segment is successfully received with Offset Field set to 0 and after the SOMEIP TP module has called the API PduRSomeIpTpStartOfReception the SOME IP TP module shall check the returned bufferSizePtr If the bufferSizePtr is greater or equal to the sum of the received payload and the added SOMEIP header the SOMEIP TP module shall call the API PduRSomeIpTpCopyRxData to pass the following assembled SOMEIP message This PDU shall contain the following content Request ID 32 bit Protoc ol Version 8 bit Interface Version 8 bit Message Type 8 bit see SWSSomeIpTp00 028 Return C ode 8 bit Payload RSSOMEIP00010 SWSSomeIpTp00 035 The SOMEIP TP module shall set the TP Flag contained in the Message Type back to 0 before the