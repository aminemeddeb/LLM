STRING ApplicationPrimitiveDataType swDataDefProps swTextProps baseType refers to a BaseType withbaseTypeDefinition baseType Encoding equal to UTF16 42 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 ImplementationDataType TheImplementationDataType shall be defined according to TPSSWCT 01650 as a STRUCTURE that contains exactly two Implementation DataTypeElement s and shall follow the rules defined by constr1318 oneImplementationDataTypeElement represents the Size Indica tor and has the category equal to TYPEREFERENCE which points to a uint8 uint16 or uint32 ImplementationDataType oneImplementationDataTypeElement has the category equal to ARRAY and contains exactly one ImplementationDataTypeElement that boils down to a uint16 ImplementationDataType cSRSXfrm00101 SWSSomeIpXf00245 Serialization of dynamic length strings dSerialization of dynamic length strings shall consist of the followign steps 1 Check whether the string terminates with 0x00 UTF8 or 0x0000 UTF16 If not a ESERGENERICERROR error shall be issued 2 Add the Length Field The value of the length field shall be computed by multi plying the number of elements given by the size indicator with the size in bytes of each element ie 1 for UTF8 and 2 for UTF16 increased by the size in bytes required by the BOM The data type of the length field shall be determined from thesizeOfStringLengthFields If the attribute sizeOfStringLength Fields is not configured then the default value of 32 bit shall be used as de fined by PRSSOMEIP00094 The value of the length field shall comply with SWSSomeIpXfCONSTR0001 3 Appending BOM at the beginning if BOM is not already available in the first 3 UTF8 or 2 UTF16 bytes of the to be serialized array containing the string If the BOM is already present simply copy the BOM into the output buffer 4 Copying the string data copy the the number of bytes according to the strings size indicator and the size of bytes of each element from the array into the out put buffer optionally performing a conversion between UTF16LE and UTF16BE between ECU and network byte order BaseTypeDirectDefinition byte Order andSOMEIPTransformationDescription byteOrder have differ ent values cSRSXfrm00101 SWSSomeIpXf00247 Deserialization of dynamic length strings dDeserialization of dynamic length strings shall consist of the following steps 1 Check whether the string starts with a BOM If not a MALFORMEDMESSAGE error shall be issued 2 Check whether BOM has the same value as SOMEIPTransformationDe scription byteOrder If not a MALFORMEDMESSAGE error shall be issued 43 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 3 Remove the BOM and reduce the value of the length field accordingly 4 Silently discard the last byte of the string in case of an UTF16 string with odd length according to the reduced value of the length field 5 Check whether the string terminates with 0x00 UTF8 or 0x0000 UTF16 If not a MALFORMEDMESSAGE error shall be issued 6 Check whether the length of the received dynamic length string is less or equal than the specified maximum length of the string ApplicationPrimitive DataTypeswTextPropsswMaxTextSize or arraySize of ImplementationDataType Element of category ARRAY If not a MALFORMEDMESSAGE error shall be issued 7 Copy the string data copy the number of bytes according to the strings reduced value of the length field from the input buffer into the array optionally perform ing a conversion between UTF16LE and UTF16BE between ECU and bus ifBaseTypeDirectDefinition byteOrder andSOMEIPTransformation Description byteOrder have different values cSRSXfrm00101 Instead of transferring application strings as SOMEIP strings with BOM and 0 ter mination strings can also be transported as plain dynamic length arrays without BOM and 0 termination see chapter Dynamic Length Arrays of 13 Please note that this requires the full string handling eg endianness conversion to be done in the applications This can also be achieved by setting the attribute im plementsLegacyStringSerialization to true In CP this attribute is configured inSOMEIPTransformationISignalProps in AP it is configured in ApSomeip TransformationProps NOTE This attribute is not future safe and will be removed in an upcoming AUTOSAR release Therefore to be forward compatible plain dynamic length arrays should preferably be used in this case 7245 Arrays fixed length SWSSomeIpXf00069 dThe length of fixed length arrays is defined by the datatype definitioncSRSXfrm00101 They can be seen as repeated elements In chapter 7247 dynamic length arrays are shown which can be also used Fixed length arrays are easier for use in very small devices Dynamic length arrays might need more resources on the ECU using them SOMEIP allows to add a length field of 8 16 or 32 bit in front of arrays The length field of an array describes the number of bytes of the array This allows extensible arrays which allow better migration of interfaces 44 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 SWSSomeIpXf00220 dIf attribute sizeOfArrayLengthFields ofSOMEIP TransformationISignalProps is set to a value greater 0 a length field shall be inserted in front of every serialized array cSRSXfrm00101 Note SWSSomeIpXf00220 also applies to nested arrays which means that additionally every nested fixedsize array has its own length field SWSSomeIpXf00256 dIf attribute sizeOfArrayLengthField ofSOMEIP TransformationProps is set to a value greater 0 a length field shall be inserted in front of the serialized array for which the SOMEIPTransformationProps is de fined See TPSSYST02121 cSRSXfrm00101 Note SWSSomeIpXf00256 applies if the length fields of the array and all nested ar rays contained are configured to different values for the lengths of the length fields via SOMEIPTransformationProps SWSSomeIpXf00257 dIf SOMEIPTransformationProps sizeOfAr rayLengthField is present for a static size array the data type for the length field of the array shall be determined by the value of SOMEIPTransformation Props sizeOfArrayLengthField uint8 ifsizeOfArrayLengthField equals 1 uint16 ifsizeOfArrayLengthField equals 2 uint32 ifsizeOfArrayLengthField equals 4 Otherwise SWSSomeIpXf00221 applies cSRSXfrm00101 SWSSomeIpXf00221 dThe data type of the length field for an array shall be determined by the value of SOMEIPTransformationISignalProps sizeOfAr rayLengthFields of the serialized ISignal uint8 ifsizeOfArrayLengthFields equals 1 uint16 ifsizeOfArrayLengthFields equals 2 uint32 ifsizeOfArrayLengthFields equals 4 cSRSXfrm00101 SWSSomeIpXf00222 dThe serializing SOMEIP transformer shall write the size in bytes of the serialized array without the size of the length field into the length field of the arraycSRSXfrm00101 SWSSomeIpXf00223 dIf the length is greater than the expected length of an array as specified in the data type definition a