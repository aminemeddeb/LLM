0 bits The type field describes the type of the element SWSSomeIpXf00250 dThe data type of the type field of the union shall be determined from the ImplementationDataType of the first Implementation DataTypeElement memberSelector in the wrapped union data type defined in SWSSomeIpXf00249 cSRSXfrm00101 52 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 SWSSomeIpXf00098 dPossible values of the type field are defined by the data type specification of the union The types are encoded as in the data type in ascending order starting with 1 The 0 is reserved for the NULL type ie an empty union c SRSXfrm00101 SWSSomeIpXf00251 dThe value of the type field shall be set to the value defined by the first ImplementationDataTypeElement memberSelector in the wrapped union data type defined in SWSSomeIpXf00249 cSRSXfrm00101 SWSSomeIpXf00099 dThe element is serialized depending on the type in the type field This also defines the length of the data All bytes behind the data that are covered by the length are padding The deserializer shall skip the padding bytes by calculat ing the required number according to the formula given in SWSSomeIpXf00088 c SRSXfrm00101 By using a struct in the data type definition different padding layouts can be achieved 72491 Example Union of uint8uint16 both padded to 32 bit In this example a length of the length field is specified as 32 bits The union shall support a uint8 and a uint16 as elements Both are padded to the 32 bit boundary length4 Bytes A uint8 will be serialized like this Length 4 Bytes Type 1 uint8 Padding 0x00 Padding 0x00 Padding 0x00 A uint16 will be serialized like this Length 4 Bytes Type 2 uint16 Padding 0x00 Padding 0x00 73 Protocol specification This chapter describes the protocol of SOMEIP for ClientServer and SenderReceiver communication 731 ClientServer Communication SWSSomeIpXf00106 dFor the SOMEIP request message the SOMEIP trans former on the clientECU has to do the following for payload and header 53 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 Construct the payload Optionally set the Request ID to a unique number shall be unique for client only Set the Protocol Version according SWSSomeIpXf00029 Set the Interface Version If interfaceVersion ofSOMEIPTransforma tionISignalProps is set this shall be used Otherwise interfaceVersion ofSOMEIPTransformationDescription shall be used Set the Message Type to Request ie 0x00 Set the Return Code to 0x00 cSRSXfrm00102 SWSSomeIpXf00120 dTo construct the payload of a request message all argu ment s of the ClientServerOperation which have direction IN orINOUT shall be serialized according to the order of the ArgumentDataPrototype s within the ClientServerOperation cSRSXfrm00102 This can be seen graphically in Figure 711 SomeIpXf XfId transactionHandle buffer bufferLength ININOUT argument1 ININOUT argumentN SOMEIP Header argument 1 argument N Payload Figure 711 Example for serialization of a ClientServer Request SWSSomeIpXf00200 dIfcsErrorReaction ofTransformationISignal Props is set to autonomous and the returnValue parameter handed over from RTE is greater or equal to 0x80 the SOMEIP transformer for a response of a clientserver communication shall generate an error message according to SWSSomeIpXf00201 else it shall generate a normal response according to SWSSomeIpXf00107 cSRSXfrm00102 SWSSomeIpXf00107 dThe SOMEIP transformer on the serverECU builds its header for the server response based on the header of the clients request and does in addition Construct the payload Set the Message Type to RESPONSE ie0x80 54 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 If the ClientServerOperation has at least one possibleError defined place the return value of the executed ClientServerOperation into the Re turn Code field and add 0x1F to adapt the number ranges in case the original return value was different from 0x00 cSRSXfrm00102 Note See also chapter 7237 SWSSomeIpXf00121 dTo construct the payload of a response message all argu ment s of the ClientServerOperation which have direction INOUT orOUT shall be serialized in the following order TheArgumentDataPrototype s with a direction of INOUT orOUT shall be serialized according to the order of the ArgumentDataPrototype s within the ClientServer Operation cSRSXfrm00102 This can be seen graphically in Figure 712 SomeIpXf XfId transactionHandle buffer bufferLength returnValue INOUTOUT argument1 INOUTOUT argumentN SOMEIP Header argument1 argumentN Payload Figure 712 Example for serialization of a ClientServer Response SWSSomeIpXf00201 dThe SOMEIP transformer on the serverECU builds its header for an autonomous error response based on the header of the clients request and does in addition Construct no payload the payload shall be empty Set the Message Type to RESPONSE ie0x80 Adapt the return value by subtracting 0x80 from the parameter returnValue calculation adaptedReturnV alue returnV alue0x80 Place the adaptedReturnValue into the Return Code field cSRSXfrm00102 Note See also chapter 7237 This leads to an output of the SOMEIP transformer which is exactly as long as the SOMEIP header 55 of 107 Document ID 660 AUTOSARSWSSOMEIPTransformerSpecification of SOMEIP Transformer AUTOSAR CP R2111 Note Error messages can only be sent as a response for clientserver requests not for SenderReceiver communication or error messages SWSSomeIpXf00202 dA SOMEIP transformer on the serverECU that builds an autonomous error response shall return with a return value equal to EOK See SWSSomeIpXf00141 cSRSXfrm00102 If the SOMEIP transformer would return with a return code different from EOK this would issue a hard error that prevents the RTE from sending the autonomous error response 732 SenderReceiver Communication Session Handling ID counter is used to set the correct Request ID in the SOMEIP header in case of SenderReceiver communication where session handling is acti vated SWSSomeIpXf00212 dOne Session Handling ID counter 16 Bit has to be maintained per transformer function for SenderReceiver communication see SWSSomeIpXf00138 if sessionHandlingSR is set to sessionHandlingAc tive cSRSXfrm00008 SWSSomeIpXf00213 dAll Session Handling ID counters shall be initialized with 0x0001 cSRSXfrm00008 SWSSomeIpXf00108 dThe SOMEIP transformer on the sender side of trans formed SenderReceiver communication shall construct header and payload in the fol lowing way Construct the payload Set the Request ID to0x00 ifsessionHandlingSR ofSOMEIPTransformationISignal Props is not set to sessionHandlingActive the current value of the Session Handling ID counter otherwise Set the Protocol Version according SWSSomeIpXf00029 Set the Interface Version If interfaceVersion ofSOMEIPTransforma tionISignalProps is set this shall be used Otherwise interfaceVersion ofSOMEIPTransformationDescription shall be used Set the Message Type according to